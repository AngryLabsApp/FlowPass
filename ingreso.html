<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FlowPass — Ingreso</title>
    <link
      rel="icon"
      href="/public/icons/logo-flowpass.svg"
      type="image/svg+xml"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Plus+Jakarta+Sans:wght@700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./public/css/index.css" />
  </head>

  <body>
    <div class="layout">
      <!-- Sidebar -->
      <aside class="sidebar"></aside>

      <!-- Content -->
      <div class="content">
        <main class="main">
          <h1 class="main__title u-hide-mobile">Ingreso</h1>
          <!-- Card de Ingreso -->
          <div class="card checkin" aria-label="Registro de ingreso">
            <!-- Boton para bloquear pantalla -->
            <div class="lock-unclock-btn" id="block-button">
              <button
                class="btn-circle"
                type="button"
                aria-pressed="false"
                aria-label="Desbloqueado"
              >
                <svg class="icon icon--sm lock-unclock-btn__icon" aria-hidden="true">
                  <use href="/public/icons/sprites.svg#unlock-code"></use>
                </svg>
              </button>
              <div class="lock-unclock-msg" aria-live="polite" hidden></div>
            </div>
            <!-- Foto -->
            <div class="checkin__avatar-wrap">
              <div
                class="checkin__avatar"
                id="checkinAvatar"
                aria-hidden="true"
              >
                <svg class="icon icon--lg">
                  <use href=""></use>
                </svg>
                <span id="checkinAvatarInitials"></span>
              </div>
              <div class="checkin__display-name" id="checkinAvatarName">
                ¡Bienvenido!
              </div>
            </div>

            <form
              id="checkinForm"
              class="form form--checkin checkin__form"
              autocomplete="off"
            >
              <div class="form__row">
                <label class="form__label" for="checkinQuery"
                  >Ingresa tu código:</label
                >
                <input
                  class="form__control form__control--ingreso form__control--code"
                  id="checkinQuery"
                  name="q"
                  placeholder="Ej. 0001"
                  aria-autocomplete="list"
                  aria-expanded="false"
                  aria-controls="checkinResults"
                  inputmode="numeric"
                />
              </div>

              <!-- Estado / mensaje (debajo del input) -->
              <p
                class="checkin__status hidden"
                id="checkinStatus"
                aria-live="polite"
              ></p>

              <!-- dropdown de sugerencias -->
              <div
                id="checkinResults"
                class="checkin__results"
                role="listbox"
                hidden
              ></div>

              <!-- selección -->
              <div id="checkinSelected" class="checkin__selected" hidden></div>

              <!-- Teclado numérico -->
              <div
                class="checkin__keypad"
                aria-label="Teclado numérico"
                role="group"
              >
                <div class="checkin__keypad-grid">
                  <button type="button" class="checkin__key" data-key="1">
                    1
                  </button>
                  <button type="button" class="checkin__key" data-key="2">
                    2
                  </button>
                  <button type="button" class="checkin__key" data-key="3">
                    3
                  </button>
                  <button type="button" class="checkin__key" data-key="4">
                    4
                  </button>
                  <button type="button" class="checkin__key" data-key="5">
                    5
                  </button>
                  <button type="button" class="checkin__key" data-key="6">
                    6
                  </button>
                  <button type="button" class="checkin__key" data-key="7">
                    7
                  </button>
                  <button type="button" class="checkin__key" data-key="8">
                    8
                  </button>
                  <button type="button" class="checkin__key" data-key="9">
                    9
                  </button>
                  <button
                    type="button"
                    class="checkin__key checkin__key--action"
                    data-key="clear"
                    aria-label="Limpiar"
                  >
                    <svg class="icon icon--md">
                      <use href="/public/icons/sprites.svg#clean-key"></use>
                    </svg>
                  </button>
                  <button type="button" class="checkin__key" data-key="0">
                    0
                  </button>
                  <button
                    type="button"
                    class="checkin__key checkin__key--action"
                    data-key="back"
                    aria-label="Borrar"
                  >
                    <svg class="icon icon--md">
                      <use href="/public/icons/sprites.svg#delete-key"></use>
                    </svg>
                  </button>
                </div>
              </div>

              <div class="form__actions">
                <button
                  class="btn btn--primary btn--primary--large"
                  type="submit"
                  id="checkinSubmit"
                  disabled
                >
                  Registrar ingreso
                </button>
              </div>
            </form>
          </div>
        </main>
      </div>
    </div>

    <!-- Modal: Ficha de usuario -->
    <div
      class="modal modal--success"
      id="userModal"
      aria-hidden="true"
      role="dialog"
      aria-modal="true"
      aria-labelledby="userModalTitle"
    >
      <div class="modal__overlay" data-close></div>
      <div class="modal__dialog card success-modal__dialog" role="document">
        <header class="modal__header success-modal__header">
          <h2 class="modal__title u-sr-only" id="userModalTitle">
            Ingreso correcto
          </h2>
          <button
            class="modal__close"
            type="button"
            aria-label="Cerrar"
            data-close
          >
            ✕
          </button>
        </header>
        <div class="modal__body success-modal">
          <img
            src="/public/icons/animations/check.gif"
            alt="Check animado"
            width="150"
            height="150"
            class="success-modal__img"
          />
          <h3 class="success-modal__title">
            ¡Bienvenido <span id="successUserName"></span>!
          </h3>
          <p class="success-modal__subtitle">Disfruta de tu clase</p>
          <p class="success-modal__classes">
            clase: <span id="successClassProgress"></span>
          </p>
          <p class="success-modal__thanks">¡Gracias!</p>
        </div>
      </div>
    </div>

    <!-- Loader modal -->
    <fp-loader id="loader"></fp-loader>

    <script src="/public/src/utils/dynamic-forms.js"></script>
    <script src="/public/src/utils/utils.js"></script>
    <script defer src="/public/src/shared/sidebar.js"></script>
    <script src="/public/src/session/session_manager.js" type="module"></script>
    <script type="module">
      import { ensureSessionOrRedirect } from "/public/src/session/session_manager.js";
      window.SessionManager = { ensureSessionOrRedirect };
      window.dispatchEvent(new Event("session-ready"));
    </script>
    <script src="/public/src/api/api.js" defer></script>
    <script src="/public/src/env.js"></script>
    <script src="/public/src/Ingreso/Ingreso.js"></script>
    <script type="module" src="/public/src/Ingreso/lock-unclock.js"></script>
    <script type="module" src="/public/components/loader/loader.js"></script>
  </body>
</html>
